
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Server Usage Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-forkmegithub/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../use/server.html" />
    
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Primer
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="../about.html">
            
                <a href="../about.html">
            
                    
                    Approaches
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="../install.html">
            
                <a href="../install.html">
            
                    
                    Installation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../features.html">
            
                <a href="../features.html">
            
                    
                    Features
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Tutorials
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../tutorial/todo-list.html">
            
                <a href="../tutorial/todo-list.html">
            
                    
                    Simple Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../tutorial/custom-server.html">
            
                <a href="../tutorial/custom-server.html">
            
                    
                    Custom Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../tutorial/dynamic.html">
            
                <a href="../tutorial/dynamic.html">
            
                    
                    Dynamic Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" >
            
                <span>
            
                    
                    Security
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="../tutorial/authentication/">
            
                <a href="../tutorial/authentication/">
            
                    
                    Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.2" data-path="../tutorial/oauth2/">
            
                <a href="../tutorial/oauth2/">
            
                    
                    OAuth2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.3" data-path="../tutorial/composed-auth/">
            
                <a href="../tutorial/composed-auth/">
            
                    
                    Composition
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Use-Cases
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../usage/swagger.html">
            
                <a href="../usage/swagger.html">
            
                    
                    Options and commands
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../usage/serve_ui.html">
            
                <a href="../usage/serve_ui.html">
            
                    
                    Serve UI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../usage/validate.html">
            
                <a href="../usage/validate.html">
            
                    
                    Validate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../usage/diff.html">
            
                <a href="../usage/diff.html">
            
                    
                    Diff
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../use/transform.html">
            
                <a href="../use/transform.html">
            
                    
                    Transform spec
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.5.1" data-path="../usage/expand.html">
            
                <a href="../usage/expand.html">
            
                    
                    Expand
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.2" data-path="../usage/flatten.html">
            
                <a href="../usage/flatten.html">
            
                    
                    Flatten
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.3" data-path="../usage/mixin.html">
            
                <a href="../usage/mixin.html">
            
                    
                    Mixin
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../usage/markdown.html">
            
                <a href="../usage/markdown.html">
            
                    
                    Generate markdown
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" >
            
                <span>
            
                    
                    Generate code from spec
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.7.1" data-path="requirements.html">
            
                <a href="requirements.html">
            
                    
                    Dependencies & Requirements
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.2" data-path="client.html">
            
                <a href="client.html">
            
                    
                    API Client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.3" data-path="cli.html">
            
                <a href="cli.html">
            
                    
                    CLI (Command Line Tool)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.4" >
            
                <span>
            
                    
                    API Server
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.4.7.4.1" data-path="server.html">
            
                <a href="server.html">
            
                    
                    Server Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.4.2" data-path="../use/server.html">
            
                <a href="../use/server.html">
            
                    
                    How to use the server
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.7.5" >
            
                <span>
            
                    
                    API Model
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.7.5.1" data-path="model.html">
            
                <a href="model.html">
            
                    
                    Model Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.5.2" data-path="../use/model.html">
            
                <a href="../use/model.html">
            
                    
                    How to use models
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.7.5.2.1" data-path="../use/models/schemas.html">
            
                <a href="../use/models/schemas.html">
            
                    
                    Schema generation rules
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.8" >
            
                <span>
            
                    
                    Generate spec from source
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.8.1" data-path="spec.html">
            
                <a href="spec.html">
            
                    
                    Spec Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2" data-path="../use/spec.html">
            
                <a href="../use/spec.html">
            
                    
                    Spec generation rules
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.8.2.1" data-path="../use/spec/meta.html">
            
                <a href="../use/spec/meta.html">
            
                    
                    swagger:meta
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.2" data-path="../use/spec/route.html">
            
                <a href="../use/spec/route.html">
            
                    
                    swagger:route
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.3" data-path="../use/spec/params.html">
            
                <a href="../use/spec/params.html">
            
                    
                    swagger:params
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.4" data-path="../use/spec/operation.html">
            
                <a href="../use/spec/operation.html">
            
                    
                    swagger:operation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.5" data-path="../use/spec/response.html">
            
                <a href="../use/spec/response.html">
            
                    
                    swagger:response
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.6" data-path="../use/spec/model.html">
            
                <a href="../use/spec/model.html">
            
                    
                    swagger:model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.7" data-path="../use/spec/allOf.html">
            
                <a href="../use/spec/allOf.html">
            
                    
                    swagger:allOf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.8" data-path="../use/spec/strfmt.html">
            
                <a href="../use/spec/strfmt.html">
            
                    
                    swagger:strfmt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.9" data-path="../use/spec/discriminated.html">
            
                <a href="../use/spec/discriminated.html">
            
                    
                    swagger:discriminated
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.10" data-path="../use/spec/ignore.html">
            
                <a href="../use/spec/ignore.html">
            
                    
                    swagger:ignore
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../use/middleware.html">
            
                <a href="../use/middleware.html">
            
                    
                    Using middleware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../use/template_layout.html">
            
                <a href="../use/template_layout.html">
            
                    
                    Custom generation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="templates.html">
            
                <a href="templates.html">
            
                    
                    Custom templates
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../cli_helpers.html">
            
                <a href="../cli_helpers.html">
            
                    
                    CLI autocompletion
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../guidelines/">
            
                <a href="../guidelines/">
            
                    
                    Guidelines to maintainers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../faq/">
            
                <a href="../faq/">
            
                    
                    FAQ
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../faq/faq_setup.html">
            
                <a href="../faq/faq_setup.html">
            
                    
                    Installation,setup and environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../faq/faq_model.html">
            
                <a href="../faq/faq_model.html">
            
                    
                    Model generation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../faq/faq_server.html">
            
                <a href="../faq/faq_server.html">
            
                    
                    Server generation & customization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../faq/faq_client.html">
            
                <a href="../faq/faq_client.html">
            
                    
                    Client generation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../faq/faq_spec.html">
            
                <a href="../faq/faq_spec.html">
            
                    
                    Spec generation from source
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../faq/faq_testing.html">
            
                <a href="../faq/faq_testing.html">
            
                    
                    API testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="../faq/faq_documenting.html">
            
                <a href="../faq/faq_documenting.html">
            
                    
                    Documenting your API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="../faq/faq_swagger.html">
            
                <a href="../faq/faq_swagger.html">
            
                    
                    Swagger specification
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Server Usage</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="generate-a-server-from-a-swagger-spec"><a name="generate-a-server-from-a-swagger-spec" class="plugin-anchor" href="#generate-a-server-from-a-swagger-spec"><i class="fa fa-link" aria-hidden="true"></i></a>Generate a server from a swagger spec</h1>
<p>The toolkit has a command that will let you generate a docker friendly server with support for TLS.
You can configure it through environment variables that are commonly used on PaaS services.</p>
<!--more-->
<p>A generated server uses <em>no reflection</em> except for an enum validation and the required validation. The server builds all the necessary plans and execution paths at startup time so that at runtime there is only the absolute minimum processing required to respond to requests.</p>
<p>The default router for go-swagger is <a href="https://github.com/naoina/denco" target="_blank">naoina&apos;s denco</a> which is a <a href="https://github.com/julienschmidt/go-http-routing-benchmark#github" target="_blank"><strong>very</strong> fast</a> ternary search tree based router that allows for much greater flexibility than the trie based router implementation of julienschmidt at almost the same and sometimes lower cost.</p>
<p>You can provide your own router implementation should you so desire it&apos;s abstracted through an interface with this use case in mind.</p>
<h3 id="server-usage"><a name="server-usage" class="plugin-anchor" href="#server-usage"><i class="fa fa-link" aria-hidden="true"></i></a>Server usage</h3>
<pre class="language-"><code>Usage:
  swagger [OPTIONS] generate server [server-OPTIONS]

generate all the files for a server application

Application Options:
  -q, --quiet                                                                     silence logs
      --log-output=LOG-FILE                                                       redirect logs to file

Help Options:
  -h, --help                                                                      Show this help message

[server command options]
      -s, --server-package=                                                       the package to save the server specific code (default: restapi)
          --main-package=                                                         the location of the generated main. Defaults to cmd/{name}-server
      -P, --principal=                                                            the model to use for the security principal
          --default-scheme=                                                       the default scheme for this API (default: http)
          --principal-is-interface                                                the security principal provided is an interface, not a struct
          --default-produces=                                                     the default mime type that API operations produce (default: application/json)
          --default-consumes=                                                     the default mime type that API operations consume (default: application/json)
          --skip-models                                                           no models will be generated when this flag is specified
          --skip-operations                                                       no operations will be generated when this flag is specified
          --skip-support                                                          no supporting files will be generated when this flag is specified
          --exclude-main                                                          exclude main function, so just generate the library
          --exclude-spec                                                          don&apos;t embed the swagger specification
          --flag-strategy=[go-flags|pflag|flag]                                   the strategy to provide flags for the server (default: go-flags)
          --compatibility-mode=[modern|intermediate]                              the compatibility mode for the tls server (default: modern)
          --regenerate-configureapi                                               Force regeneration of configureapi.go
      -A, --name=                                                                 the name of the application, defaults to a mangled value of info.title
          --with-context                                                          handlers get a context as first arg (deprecated)

    Options common to all code generation commands:
      -f, --spec=                                                                 the spec file to use (default swagger.{json,yml,yaml})
      -t, --target=                                                               the base directory for generating the files (default: ./)
          --template=[stratoscale]                                                load contributed templates
      -T, --template-dir=                                                         alternative template override directory
      -C, --config-file=                                                          configuration file to use for overriding template options
      -r, --copyright-file=                                                       copyright file used to add copyright header
          --additional-initialism=                                                consecutive capitals that should be considered intialisms
          --allow-template-override                                               allows overriding protected templates
          --skip-validation                                                       skips validation of spec prior to generation
          --dump-data                                                             when present dumps the json for the template generator instead of generating files
          --with-expand                                                           expands all $ref&apos;s in spec prior to generation (shorthand to --with-flatten=expand)
          --with-flatten=[minimal|full|expand|verbose|noverbose|remove-unused]    flattens all $ref&apos;s in spec prior to generation (default: minimal, verbose)

    Options for model generation:
      -m, --model-package=                                                        the package to save the models (default: models)
      -M, --model=                                                                specify a model to include in generation, repeat for multiple (defaults to all)
          --existing-models=                                                      use pre-generated models e.g. github.com/foobar/model
          --strict-additional-properties                                          disallow extra properties when additionalProperties is set to false
          --keep-spec-order                                                       keep schema properties order identical to spec file
          --struct-tags                                                           specify custom struct tags for third-party libraries, repeat for multiple (defaults to json)

    Options for operation generation:
      -O, --operation=                                                            specify an operation to include, repeat for multiple (defaults to all)
          --tags=                                                                 the tags to include, if not specified defaults to all
      -a, --api-package=                                                          the package to save the operations (default: operations)
          --with-enum-ci                                                          set all enumerations case-insensitive by default
          --skip-tag-packages                                                     skips the generation of tag-based operation packages, resulting in a flat generation
</code></pre><h3 id="build-a-server"><a name="build-a-server" class="plugin-anchor" href="#build-a-server"><i class="fa fa-link" aria-hidden="true"></i></a>Build a server</h3>
<p>The server application gets generated with all the handlers stubbed out with a not implemented handler. That means that you can start the API server immediately after generating it. It will respond to all valid requests with 501 Not Implemented. When a request is invalid it will most likely respond with an appropriate 4xx response.</p>
<p>The generated server allows for a number of command line parameters to customize it.</p>
<pre class="language-"><code>      --cleanup-timeout duration     grace period for which to wait before killing idle connections (default 10s)
      --graceful-timeout duration    grace period for which to wait before shutting down the server (default 15s)
      --host string                  the IP to listen on (default &quot;localhost&quot;)
      --keep-alive duration          sets the TCP keep-alive timeouts on accepted connections. It prunes dead TCP connections ( e.g. closing laptop mid-download) (default 3m0s)
      --listen-limit int             limit the number of outstanding requests
      --max-header-size byte-size    controls the maximum number of bytes the server will read parsing the request header&apos;s keys and values, including the request line. It does not limit the size of the request body (default 1MB)
      --port int                     the port to listen on for insecure connections, defaults to a random value
      --read-timeout duration        maximum duration before timing out read of the request (default 30s)
      --scheme strings               the listeners to enable, this can be repeated and defaults to the schemes in the swagger spec (default [http,https,unix])
      --socket-path string           the unix socket to listen on (default &quot;/var/run/todo-list.sock&quot;)
      --tls-ca string                the certificate authority certificate file to be used with mutual tls auth
      --tls-certificate string       the certificate file to use for secure connections
      --tls-host string              the IP to listen on (default &quot;localhost&quot;)
      --tls-keep-alive duration      sets the TCP keep-alive timeouts on accepted connections. It prunes dead TCP connections ( e.g. closing laptop mid-download) (default 3m0s)
      --tls-key string               the private key file to use for secure connections (without passphrase)
      --tls-listen-limit int         limit the number of outstanding requests
      --tls-port int                 the port to listen on for secure connections, defaults to a random value
      --tls-read-timeout duration    maximum duration before timing out read of the request (default 30s)
      --tls-write-timeout duration   maximum duration before timing out write of the response (default 30s)
      --write-timeout duration       maximum duration before timing out write of the response (default 30s)
</code></pre><p>The server takes care of a number of things when a request arrives:</p>
<ul>
<li>routing</li>
<li>authentication</li>
<li>input validation</li>
<li>content negotiation</li>
<li>parameter and body binding</li>
</ul>
<p>To illustrate this with a pseudo handler, this is what happens in a request.</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;net/http&quot;</span>

  <span class="token string">&quot;github.com/go-openapi/errors&quot;</span>
  <span class="token string">&quot;github.com/go-openapi/runtime/middleware&quot;</span>
  <span class="token string">&quot;github.com/gorilla/context&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">newCompleteMiddleware</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>middleware<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> http<span class="token punctuation">.</span>Handler <span class="token punctuation">{</span>
  <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">HandlerFunc</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>rw http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">defer</span> context<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>

    <span class="token comment">// use context to lookup routes</span>
    <span class="token keyword">if</span> matched<span class="token punctuation">,</span> ok <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">RouteInfo</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>

      <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>matched<span class="token punctuation">.</span>Authenticators<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">Authorize</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> matched<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
          ctx<span class="token punctuation">.</span><span class="token function">Respond</span><span class="token punctuation">(</span>rw<span class="token punctuation">,</span> r<span class="token punctuation">,</span> matched<span class="token punctuation">.</span>Produces<span class="token punctuation">,</span> matched<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
          <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      bound<span class="token punctuation">,</span> validation <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">BindAndValidate</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> matched<span class="token punctuation">)</span>
      <span class="token keyword">if</span> validation <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">Respond</span><span class="token punctuation">(</span>rw<span class="token punctuation">,</span> r<span class="token punctuation">,</span> matched<span class="token punctuation">.</span>Produces<span class="token punctuation">,</span> matched<span class="token punctuation">,</span> validation<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>

      result<span class="token punctuation">,</span> err <span class="token operator">:=</span> matched<span class="token punctuation">.</span>Handler<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span>bound<span class="token punctuation">)</span>
      <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">Respond</span><span class="token punctuation">(</span>rw<span class="token punctuation">,</span> r<span class="token punctuation">,</span> matched<span class="token punctuation">.</span>Produces<span class="token punctuation">,</span> matched<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>

      ctx<span class="token punctuation">.</span><span class="token function">Respond</span><span class="token punctuation">(</span>rw<span class="token punctuation">,</span> r<span class="token punctuation">,</span> matched<span class="token punctuation">.</span>Produces<span class="token punctuation">,</span> matched<span class="token punctuation">,</span> result<span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Not found, check if it exists in the other methods first</span>
    <span class="token keyword">if</span> others <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">AllowedMethods</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">len</span><span class="token punctuation">(</span>others<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
      ctx<span class="token punctuation">.</span><span class="token function">Respond</span><span class="token punctuation">(</span>rw<span class="token punctuation">,</span> r<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>spec<span class="token punctuation">.</span><span class="token function">RequiredProduces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">MethodNotAllowed</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Method<span class="token punctuation">,</span> others<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    ctx<span class="token punctuation">.</span><span class="token function">Respond</span><span class="token punctuation">(</span>rw<span class="token punctuation">,</span> r<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>spec<span class="token punctuation">.</span><span class="token function">RequiredProduces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token string">&quot;path %s was not found&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Prior to handling requests however you probably want to configure the API with some actual implementations.  To do that you have to edit the configure_xxx.go file.  That file will only be generated the first time you generate a server application from a swagger spec. So the generated server uses this file to let you fill in the blanks.</p>
<p>For the todolist application that file looks like:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;github.com/go-openapi/errors&quot;</span>
    <span class="token string">&quot;github.com/go-openapi/runtime&quot;</span>
    <span class="token string">&quot;github.com/go-openapi/runtime/middleware&quot;</span>

    <span class="token string">&quot;github.com/go-openapi/examples/todo-list/restapi/operations&quot;</span>
    <span class="token string">&quot;github.com/go-openapi/examples/todo-list/restapi/operations/todos&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// This file is safe to edit. Once it exists it will not be overwritten</span>

<span class="token keyword">func</span> <span class="token function">configureAPI</span><span class="token punctuation">(</span>api <span class="token operator">*</span>operations<span class="token punctuation">.</span>ToDoListAPI<span class="token punctuation">)</span> http<span class="token punctuation">.</span>Handler <span class="token punctuation">{</span>
    <span class="token comment">// configure the api here</span>
    api<span class="token punctuation">.</span>JSONConsumer <span class="token operator">=</span> runtime<span class="token punctuation">.</span><span class="token function">JSONConsumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    api<span class="token punctuation">.</span>JSONProducer <span class="token operator">=</span> runtime<span class="token punctuation">.</span><span class="token function">JSONProducer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    api<span class="token punctuation">.</span>KeyAuth <span class="token operator">=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>token <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">NotImplemented</span><span class="token punctuation">(</span><span class="token string">&quot;api key auth (key) x-petstore-token from header has not yet been implemented&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    api<span class="token punctuation">.</span>AddOneHandler <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">AddOneHandlerFunc</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>params todos<span class="token punctuation">.</span>AddOneParams<span class="token punctuation">,</span> principal <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> middleware<span class="token punctuation">.</span>Responder <span class="token punctuation">{</span>
        <span class="token keyword">return</span> middleware<span class="token punctuation">.</span><span class="token function">NotImplemented</span><span class="token punctuation">(</span><span class="token string">&quot;operation addOne has not yet been implemented&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    api<span class="token punctuation">.</span>DestroyOneHandler <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">DestroyOneHandlerFunc</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>params todos<span class="token punctuation">.</span>DestroyOneParams<span class="token punctuation">,</span> principal <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> middleware<span class="token punctuation">.</span>Responder <span class="token punctuation">{</span>
        <span class="token keyword">return</span> middleware<span class="token punctuation">.</span><span class="token function">NotImplemented</span><span class="token punctuation">(</span><span class="token string">&quot;operation destroyOne has not yet been implemented&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    api<span class="token punctuation">.</span>FindHandler <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">FindHandlerFunc</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>params todos<span class="token punctuation">.</span>FindParams<span class="token punctuation">,</span> principal <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> middleware<span class="token punctuation">.</span>Responder <span class="token punctuation">{</span>
        <span class="token keyword">return</span> middleware<span class="token punctuation">.</span><span class="token function">NotImplemented</span><span class="token punctuation">(</span><span class="token string">&quot;operation find has not yet been implemented&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    api<span class="token punctuation">.</span>UpdateOneHandler <span class="token operator">=</span> todos<span class="token punctuation">.</span><span class="token function">UpdateOneHandlerFunc</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>params todos<span class="token punctuation">.</span>UpdateOneParams<span class="token punctuation">,</span> principal <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> middleware<span class="token punctuation">.</span>Responder <span class="token punctuation">{</span>
        <span class="token keyword">return</span> middleware<span class="token punctuation">.</span><span class="token function">NotImplemented</span><span class="token punctuation">(</span><span class="token string">&quot;operation updateOne has not yet been implemented&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token function">setupGlobalMiddleware</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span><span class="token function">Serve</span><span class="token punctuation">(</span>setupMiddlewares<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>When you look at the code for the configureAPI method then you&apos;ll notice that the api object has properties for consumers.
A consumer is an object that can marshal things from a wireformat to an object.  Consumers and their counterpart producers who write objects get their names generated from the consumes and produces properties on a swagger specification.</p>
<p>Often, this will be JSON. If you want to use XML, additionally you have to enable XML compatible models when generating the server. For that, you have to set the command options <code>--default-consumes</code> or <code>--default-produces</code> to an XML mime type like <code>application/xml</code>. For more details on using XML, also see the <a href="client.html">client generation</a>.</p>
<p>The interface definitions for consumers and producers look like this:</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// ConsumerFunc represents a function that can be used as a consumer</span>
<span class="token keyword">type</span> ConsumerFunc <span class="token keyword">func</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>Reader<span class="token punctuation">,</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">error</span>

<span class="token comment">// Consume consumes the reader into the data parameter</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>fn ConsumerFunc<span class="token punctuation">)</span> <span class="token function">Consume</span><span class="token punctuation">(</span>reader io<span class="token punctuation">.</span>Reader<span class="token punctuation">,</span> data <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>reader<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Consumer implementations know how to bind the values on the provided interface to</span>
<span class="token comment">// data provided by the request body</span>
<span class="token keyword">type</span> Consumer <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token comment">// Consume performs the binding of request values</span>
    <span class="token function">Consume</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>Reader<span class="token punctuation">,</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">}</span>

<span class="token comment">// ProducerFunc represents a function that can be used as a producer</span>
<span class="token keyword">type</span> ProducerFunc <span class="token keyword">func</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>Writer<span class="token punctuation">,</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">error</span>

<span class="token comment">// Produce produces the response for the provided data</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>f ProducerFunc<span class="token punctuation">)</span> <span class="token function">Produce</span><span class="token punctuation">(</span>writer io<span class="token punctuation">.</span>Writer<span class="token punctuation">,</span> data <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span>writer<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Producer implementations know how to turn the provided interface into a valid</span>
<span class="token comment">// HTTP response</span>
<span class="token keyword">type</span> Producer <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token comment">// Produce writes to the http response</span>
    <span class="token function">Produce</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>Writer<span class="token punctuation">,</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">}</span>
</code></pre>
<p>So it&apos;s something that can turn a reader into a hydrated interface. A producer is the counterpart of a consumer and writes objects to an io.Writer.  When you configure an api with those you make sure it can marshal the types for the supported content types.</p>
<p>Go swagger automatically provides consumers and producers for known media types. To register a new mapping for a media
type or to override an existing mapping, call the corresponding API functions in your configure_xxx.go file:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">configureAPI</span><span class="token punctuation">(</span>api <span class="token operator">*</span>operations<span class="token punctuation">.</span>ToDoListAPI<span class="token punctuation">)</span> http<span class="token punctuation">.</span>Handler <span class="token punctuation">{</span>
    <span class="token comment">// other setup code here...</span>

    api<span class="token punctuation">.</span><span class="token function">RegisterConsumer</span><span class="token punctuation">(</span><span class="token string">&quot;application/pkcs10&quot;</span><span class="token punctuation">,</span> myCustomConsumer<span class="token punctuation">)</span>
    api<span class="token punctuation">.</span><span class="token function">RegisterProducer</span><span class="token punctuation">(</span><span class="token string">&quot;application/pkcs10&quot;</span><span class="token punctuation">,</span> myCustomProducer<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The next thing that happens in the configureAPI method is setting up the authentication with a stub handler in this case. This particular swagger specification supports token based authentication and as such it wants you to configure a token auth handler.  Any error for an authentication handler is assumed to be an invalid authentication and will return the 401 status code.</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// UserPassAuthentication authentication function</span>
<span class="token keyword">type</span> UserPassAuthentication <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>

<span class="token comment">// TokenAuthentication authentication function</span>
<span class="token keyword">type</span> TokenAuthentication <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>

<span class="token comment">// AuthenticatorFunc turns a function into an authenticator</span>
<span class="token keyword">type</span> AuthenticatorFunc <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>

<span class="token comment">// Authenticate authenticates the request with the provided data</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>f AuthenticatorFunc<span class="token punctuation">)</span> <span class="token function">Authenticate</span><span class="token punctuation">(</span>params <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Authenticator represents an authentication strategy</span>
<span class="token comment">// implementations of Authenticator know how to authenticate the</span>
<span class="token comment">// request data and translate that into a valid principal object or an error</span>
<span class="token keyword">type</span> Authenticator <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Authenticate</span><span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>So we finally get to configuring our route handlers. For each operation there exists an interface so that implementations have some freedom to provide alternative implementations. For example mocks in certain tests, automatic stubbing handlers, not implemented handlers. Let&apos;s look at the addOne handler in a bit more detail.</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// AddOneHandlerFunc turns a function with the right signature into a add one handler</span>
<span class="token keyword">type</span> AddOneHandlerFunc <span class="token keyword">func</span><span class="token punctuation">(</span>AddOneParams<span class="token punctuation">,</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> middleware<span class="token punctuation">.</span>Responder

<span class="token comment">// Handle executing the request and returning a response</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>fn AddOneHandlerFunc<span class="token punctuation">)</span> <span class="token function">Handle</span><span class="token punctuation">(</span>params AddOneParams<span class="token punctuation">,</span> principal <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> middleware<span class="token punctuation">.</span>Responder <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> principal<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// AddOneHandler interface for that can handle valid add one params</span>
<span class="token keyword">type</span> AddOneHandler <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Handle</span><span class="token punctuation">(</span>AddOneParams<span class="token punctuation">,</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> middleware<span class="token punctuation">.</span>Responder
<span class="token punctuation">}</span>
</code></pre>
<p>Because the <code>addOne</code> operation requires authentication, this interface definition requires 2 arguments. The first argument is about the request parameters and the second parameter is the security principal for the request.  In this case it is of type <code>interface{}</code>, typically that is a type like Account, User, Session, ...</p>
<p>It is your job to provide such a handler. Go swagger guarantees that by the time the request processing ends up at the handler, the parameters and security principal have been bound and validated.  So you can safely proceed with saving the request body to some persistence medium perhaps.</p>
<p>There is a context that gets created where the handlers get wired up into a <code>http.Handler</code>. For the add one this looks like this:</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// NewAddOne creates a new http.Handler for the add one operation</span>
<span class="token keyword">func</span> <span class="token function">NewAddOne</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>middleware<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> handler AddOneHandler<span class="token punctuation">)</span> <span class="token operator">*</span>AddOne <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>AddOne<span class="token punctuation">{</span>Context<span class="token punctuation">:</span> ctx<span class="token punctuation">,</span> Handler<span class="token punctuation">:</span> handler<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/*AddOne swagger:route POST / todos addOne

AddOne add one API

*/</span>
<span class="token keyword">type</span> AddOne <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Context <span class="token operator">*</span>middleware<span class="token punctuation">.</span>Context
    Params  AddOneParams
    Handler AddOneHandler
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>o <span class="token operator">*</span>AddOne<span class="token punctuation">)</span> <span class="token function">ServeHTTP</span><span class="token punctuation">(</span>rw http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    route<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> o<span class="token punctuation">.</span>Context<span class="token punctuation">.</span><span class="token function">RouteInfo</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>

    uprinc<span class="token punctuation">,</span> err <span class="token operator">:=</span> o<span class="token punctuation">.</span>Context<span class="token punctuation">.</span><span class="token function">Authorize</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> route<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        o<span class="token punctuation">.</span>Context<span class="token punctuation">.</span><span class="token function">Respond</span><span class="token punctuation">(</span>rw<span class="token punctuation">,</span> r<span class="token punctuation">,</span> route<span class="token punctuation">.</span>Produces<span class="token punctuation">,</span> route<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> principal <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">if</span> uprinc <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        principal <span class="token operator">=</span> uprinc
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> err <span class="token operator">:=</span> o<span class="token punctuation">.</span>Context<span class="token punctuation">.</span><span class="token function">BindValidRequest</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> route<span class="token punctuation">,</span> <span class="token operator">&amp;</span>o<span class="token punctuation">.</span>Params<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span> <span class="token comment">// bind params</span>
        o<span class="token punctuation">.</span>Context<span class="token punctuation">.</span><span class="token function">Respond</span><span class="token punctuation">(</span>rw<span class="token punctuation">,</span> r<span class="token punctuation">,</span> route<span class="token punctuation">.</span>Produces<span class="token punctuation">,</span> route<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    res <span class="token operator">:=</span> o<span class="token punctuation">.</span>Handler<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>Params<span class="token punctuation">,</span> principal<span class="token punctuation">)</span> <span class="token comment">// actually handle the request</span>

    o<span class="token punctuation">.</span>Context<span class="token punctuation">.</span><span class="token function">Respond</span><span class="token punctuation">(</span>rw<span class="token punctuation">,</span> r<span class="token punctuation">,</span> route<span class="token punctuation">.</span>Produces<span class="token punctuation">,</span> route<span class="token punctuation">,</span> res<span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre>
<p>The <code>http.Handler</code> implementation takes care of authentication, binding, user code execution and generating a response. For authentication this request would end up in the <code>TokenAuthentication</code> handler that was put on the api context object earlier.  When a request is authenticated it gets bound. This operation eventually requires an object that is an implementation of <code>RequestBinder</code>.  The <code>AddOneParams</code> are such an implementation:</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// RequestBinder is an interface for types to implement</span>
<span class="token comment">// when they want to be able to bind from a request</span>
<span class="token keyword">type</span> RequestBinder <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">BindRequest</span><span class="token punctuation">(</span><span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> <span class="token operator">*</span>MatchedRoute<span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">}</span>

<span class="token comment">// AddOneParams contains all the bound params for the add one operation</span>
<span class="token comment">// typically these are obtained from a http.Request</span>
<span class="token comment">//</span>
<span class="token comment">// swagger:parameters addOne</span>
<span class="token keyword">type</span> AddOneParams <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token comment">/*
      In: body
    */</span>
    Body <span class="token operator">*</span>models<span class="token punctuation">.</span>Item
<span class="token punctuation">}</span>

<span class="token comment">// BindRequest both binds and validates a request, it assumes that complex things implement a Validatable(strfmt.Registry) error interface</span>
<span class="token comment">// for simple values it will use straight method calls</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>o <span class="token operator">*</span>AddOneParams<span class="token punctuation">)</span> <span class="token function">BindRequest</span><span class="token punctuation">(</span>r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> route <span class="token operator">*</span>middleware<span class="token punctuation">.</span>MatchedRoute<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> res <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">error</span>

    <span class="token keyword">var</span> body models<span class="token punctuation">.</span>Item
    <span class="token keyword">if</span> err <span class="token operator">:=</span> route<span class="token punctuation">.</span>Consumer<span class="token punctuation">.</span><span class="token function">Consume</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Body<span class="token punctuation">,</span> <span class="token operator">&amp;</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        res <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">NewParseError</span><span class="token punctuation">(</span><span class="token string">&quot;body&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;body&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> err <span class="token operator">:=</span> body<span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>Formats<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            res <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
            o<span class="token punctuation">.</span>Body <span class="token operator">=</span> <span class="token operator">&amp;</span>body
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">CompositeValidationError</span><span class="token punctuation">(</span>res<span class="token operator">...</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In this example there is only a body parameter, so we make use of the selected consumer to read the request body and turn it into an instance of models.Item. When the body parameter is bound, it gets validated and when validation passes no error is returned and the body property is set.  After a request is bound and validated the parameters and security principal are passed to the request handler. For this configuration that would return a 501 responder.</p>
<p>Go swagger uses responders which are an interface implementation for things that can write to a response. For the generated server there are status code response and a default response object generated for every entry in the spec. For the <code>addOne</code> operation that are 2 objects one for the success case (201) and one for an error (default).</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// Responder is an interface for types to implement</span>
<span class="token comment">// when they want to be considered for writing HTTP responses</span>
<span class="token keyword">type</span> Responder <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">WriteResponse</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> runtime<span class="token punctuation">.</span>Producer<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/*AddOneCreated Created

swagger:response addOneCreated
*/</span>
<span class="token keyword">type</span> AddOneCreated <span class="token keyword">struct</span> <span class="token punctuation">{</span>

    <span class="token comment">// In: body</span>
    Payload <span class="token operator">*</span>models<span class="token punctuation">.</span>Item <span class="token string">`json:&quot;body,omitempty&quot;`</span>
<span class="token punctuation">}</span>

<span class="token comment">// WriteResponse to the client</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>o <span class="token operator">*</span>AddOneCreated<span class="token punctuation">)</span> <span class="token function">WriteResponse</span><span class="token punctuation">(</span>rw http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> producer runtime<span class="token punctuation">.</span>Producer<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    rw<span class="token punctuation">.</span><span class="token function">WriteHeader</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> o<span class="token punctuation">.</span>Payload <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> err <span class="token operator">:=</span> producer<span class="token punctuation">.</span><span class="token function">Produce</span><span class="token punctuation">(</span>rw<span class="token punctuation">,</span> o<span class="token punctuation">.</span>Payload<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">// let the recovery middleware deal with this</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/*AddOneDefault error

swagger:response addOneDefault
*/</span>
<span class="token keyword">type</span> AddOneDefault <span class="token keyword">struct</span> <span class="token punctuation">{</span>

    <span class="token comment">// In: body</span>
    Payload <span class="token operator">*</span>models<span class="token punctuation">.</span>Error <span class="token string">`json:&quot;body,omitempty&quot;`</span>
<span class="token punctuation">}</span>

<span class="token comment">// WriteResponse to the client</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>o <span class="token operator">*</span>AddOneDefault<span class="token punctuation">)</span> <span class="token function">WriteResponse</span><span class="token punctuation">(</span>rw http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> producer runtime<span class="token punctuation">.</span>Producer<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    rw<span class="token punctuation">.</span><span class="token function">WriteHeader</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> o<span class="token punctuation">.</span>Payload <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> err <span class="token operator">:=</span> producer<span class="token punctuation">.</span><span class="token function">Produce</span><span class="token punctuation">(</span>rw<span class="token punctuation">,</span> o<span class="token punctuation">.</span>Payload<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">// let the recovery middleware deal with this</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>So an implementer of the <code>AddOneHandler</code> could return one of these 2 objects and go-swagger is able to respect the contract set forward by the spec document.</p>
<p>So to implement the AddOneHandler you could do something like this.</p>
<pre class="language-"><code class="lang-go">todos<span class="token punctuation">.</span><span class="token function">AddOneHandlerFunc</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>params todos<span class="token punctuation">.</span>AddOneParams<span class="token punctuation">,</span> principal <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> middleware<span class="token punctuation">.</span>Responder <span class="token punctuation">{</span>
  created<span class="token punctuation">,</span> err <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> AddOneDefault<span class="token punctuation">{</span>models<span class="token punctuation">.</span>Error<span class="token punctuation">{</span><span class="token number">500</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> AddOneCreated<span class="token punctuation">{</span>created<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                
                <a href="../use/server.html" class="navigation navigation-next navigation-unique" aria-label="Next page: How to use the server">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Server Usage","level":"1.4.7.4.1","depth":4,"next":{"title":"How to use the server","level":"1.4.7.4.2","depth":4,"path":"use/server.md","ref":"use/server.md","articles":[]},"previous":{"title":"API Server","level":"1.4.7.4","depth":3,"ref":"","articles":[{"title":"Server Usage","level":"1.4.7.4.1","depth":4,"path":"generate/server.md","ref":"generate/server.md","articles":[]},{"title":"How to use the server","level":"1.4.7.4.2","depth":4,"path":"use/server.md","ref":"use/server.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["forkmegithub","prism","-highlight","anchors"],"root":"./docs","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"forkmegithub":{"color":"green","url":"https://github.com/go-swagger/go-swagger"},"prism":{},"anchors":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"generate/server.md","mtime":"2020-12-03T21:23:31.565Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-01-23T22:21:57.083Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-forkmegithub/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

