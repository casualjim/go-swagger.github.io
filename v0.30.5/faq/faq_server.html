
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Server generation & customization Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-forkmegithub/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="faq_client.html" />
    
    
    <link rel="prev" href="faq_model.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Primer
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="../about.html">
            
                <a href="../about.html">
            
                    
                    Approaches
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="../install.html">
            
                <a href="../install.html">
            
                    
                    Installation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../features.html">
            
                <a href="../features.html">
            
                    
                    Features
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Tutorials
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../tutorial/todo-list.html">
            
                <a href="../tutorial/todo-list.html">
            
                    
                    Simple Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../tutorial/custom-server.html">
            
                <a href="../tutorial/custom-server.html">
            
                    
                    Custom Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../tutorial/dynamic.html">
            
                <a href="../tutorial/dynamic.html">
            
                    
                    Dynamic Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" >
            
                <span>
            
                    
                    Security
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="../tutorial/authentication/">
            
                <a href="../tutorial/authentication/">
            
                    
                    Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.2" data-path="../tutorial/oauth2/">
            
                <a href="../tutorial/oauth2/">
            
                    
                    OAuth2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.3" data-path="../tutorial/composed-auth/">
            
                <a href="../tutorial/composed-auth/">
            
                    
                    Composition
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Use-Cases
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../usage/swagger.html">
            
                <a href="../usage/swagger.html">
            
                    
                    Options and commands
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../usage/serve_ui.html">
            
                <a href="../usage/serve_ui.html">
            
                    
                    Serve UI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../usage/validate.html">
            
                <a href="../usage/validate.html">
            
                    
                    Validate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../usage/diff.html">
            
                <a href="../usage/diff.html">
            
                    
                    Diff
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../use/transform.html">
            
                <a href="../use/transform.html">
            
                    
                    Transform spec
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.5.1" data-path="../usage/expand.html">
            
                <a href="../usage/expand.html">
            
                    
                    Expand
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.2" data-path="../usage/flatten.html">
            
                <a href="../usage/flatten.html">
            
                    
                    Flatten
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.3" data-path="../usage/mixin.html">
            
                <a href="../usage/mixin.html">
            
                    
                    Mixin
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../usage/markdown.html">
            
                <a href="../usage/markdown.html">
            
                    
                    Generate markdown
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" >
            
                <span>
            
                    
                    Generate code from spec
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.7.1" data-path="../generate/requirements.html">
            
                <a href="../generate/requirements.html">
            
                    
                    Dependencies & Requirements
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.2" data-path="../generate/client.html">
            
                <a href="../generate/client.html">
            
                    
                    API Client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.3" data-path="../generate/cli.html">
            
                <a href="../generate/cli.html">
            
                    
                    CLI (Command Line Tool)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.4" >
            
                <span>
            
                    
                    API Server
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.7.4.1" data-path="../generate/server.html">
            
                <a href="../generate/server.html">
            
                    
                    Server Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.4.2" data-path="../use/server.html">
            
                <a href="../use/server.html">
            
                    
                    How to use the server
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.7.5" >
            
                <span>
            
                    
                    API Model
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.7.5.1" data-path="../generate/model.html">
            
                <a href="../generate/model.html">
            
                    
                    Model Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.5.2" data-path="../use/model.html">
            
                <a href="../use/model.html">
            
                    
                    How to use models
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.7.5.2.1" data-path="../use/models/schemas.html">
            
                <a href="../use/models/schemas.html">
            
                    
                    Schema generation rules
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.8" >
            
                <span>
            
                    
                    Generate spec from source
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.8.1" data-path="../generate/spec.html">
            
                <a href="../generate/spec.html">
            
                    
                    Spec Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2" data-path="../use/spec.html">
            
                <a href="../use/spec.html">
            
                    
                    Spec generation rules
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.8.2.1" data-path="../use/spec/meta.html">
            
                <a href="../use/spec/meta.html">
            
                    
                    swagger:meta
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.2" data-path="../use/spec/route.html">
            
                <a href="../use/spec/route.html">
            
                    
                    swagger:route
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.3" data-path="../use/spec/params.html">
            
                <a href="../use/spec/params.html">
            
                    
                    swagger:params
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.4" data-path="../use/spec/operation.html">
            
                <a href="../use/spec/operation.html">
            
                    
                    swagger:operation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.5" data-path="../use/spec/response.html">
            
                <a href="../use/spec/response.html">
            
                    
                    swagger:response
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.6" data-path="../use/spec/model.html">
            
                <a href="../use/spec/model.html">
            
                    
                    swagger:model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.7" data-path="../use/spec/allOf.html">
            
                <a href="../use/spec/allOf.html">
            
                    
                    swagger:allOf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.8" data-path="../use/spec/strfmt.html">
            
                <a href="../use/spec/strfmt.html">
            
                    
                    swagger:strfmt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.9" data-path="../use/spec/discriminated.html">
            
                <a href="../use/spec/discriminated.html">
            
                    
                    swagger:discriminated
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.10" data-path="../use/spec/ignore.html">
            
                <a href="../use/spec/ignore.html">
            
                    
                    swagger:ignore
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../use/middleware.html">
            
                <a href="../use/middleware.html">
            
                    
                    Using middleware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../use/template_layout.html">
            
                <a href="../use/template_layout.html">
            
                    
                    Custom generation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../generate/templates.html">
            
                <a href="../generate/templates.html">
            
                    
                    Custom templates
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../cli_helpers.html">
            
                <a href="../cli_helpers.html">
            
                    
                    CLI autocompletion
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../guidelines/">
            
                <a href="../guidelines/">
            
                    
                    Guidelines to maintainers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="./">
            
                <a href="./">
            
                    
                    FAQ
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="faq_setup.html">
            
                <a href="faq_setup.html">
            
                    
                    Installation,setup and environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="faq_model.html">
            
                <a href="faq_model.html">
            
                    
                    Model generation
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.9.3" data-path="faq_server.html">
            
                <a href="faq_server.html">
            
                    
                    Server generation & customization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="faq_client.html">
            
                <a href="faq_client.html">
            
                    
                    Client generation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="faq_spec.html">
            
                <a href="faq_spec.html">
            
                    
                    Spec generation from source
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="faq_testing.html">
            
                <a href="faq_testing.html">
            
                    
                    API testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="faq_documenting.html">
            
                <a href="faq_documenting.html">
            
                    
                    Documenting your API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="faq_swagger.html">
            
                <a href="faq_swagger.html">
            
                    
                    Swagger specification
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Server generation & customization</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <!-- Questions about server generation -->
<h2 id="server-generation-and-customization"><a name="server-generation-and-customization" class="plugin-anchor" href="#server-generation-and-customization"><i class="fa fa-link" aria-hidden="true"></i></a>Server generation and customization</h2>
<h3 id="what-are-the-dependencies-required-by-the-generated-server"><a name="what-are-the-dependencies-required-by-the-generated-server" class="plugin-anchor" href="#what-are-the-dependencies-required-by-the-generated-server"><i class="fa fa-link" aria-hidden="true"></i></a>What are the dependencies required by the generated server?</h3>
<p>The code generation process ends with a message indicating package dependencies for your generated code.</p>
<p>Basically, here are the required packages:</p>
<ul>
<li><a href="https://www.github.com/go-openapi/errors" target="_blank"><code>github.com/go-openapi/errors</code></a></li>
<li><a href="https://www.github.com/go-openapi/loads" target="_blank"><code>github.com/go-openapi/loads</code></a></li>
<li><a href="https://www.github.com/go-openapi/runtime" target="_blank"><code>github.com/go-openapi/runtime</code></a></li>
<li><a href="https://www.github.com/go-openapi/spec" target="_blank"><code>github.com/go-openapi/spec</code></a></li>
<li><a href="https://www.github.com/go-openapi/strfmt" target="_blank"><code>github.com/go-openapi/strfmt</code></a></li>
<li><a href="https://www.github.com/go-openapi/swag" target="_blank"><code>github.com/go-openapi/swag</code></a></li>
<li><a href="https://www.github.com/go-openapi/validate" target="_blank"><code>github.com/go-openapi/validate</code></a></li>
</ul>
<p>And depending on your generation options, a command line flags handling package:</p>
<ul>
<li><a href="https://www.github.com/jessevdk/go-flags" target="_blank"><code>github.com/jessevdk/go-flags</code></a>, or</li>
<li><a href="https://www.github.com/spf13/pflag" target="_blank"><code>github.com/spf13/pflag</code></a></li>
<li><a href="flag"><code>flag</code></a></li>
</ul>
<p>This dependency used to be necessary up to release 0.14:</p>
<ul>
<li><a href="https://www.github.com/tylerb/graceful" target="_blank"><code>github.com/tylerb/graceful</code></a></li>
</ul>
<p>These packages may of course be <em>vendored</em> with your own source.</p>
<p>Originally from issue <a href="https://github.com/go-swagger/go-swagger/issues/1085" target="_blank">#1085</a>.</p>
<h3 id="how-to-add-custom-flags"><a name="how-to-add-custom-flags" class="plugin-anchor" href="#how-to-add-custom-flags"><i class="fa fa-link" aria-hidden="true"></i></a>How to add custom flags?</h3>
<p><code>go-swagger</code> ships with an option to select a flag management package: <code>swagger generate server --flag-strategy=[go-flags|pflag|flag]</code></p>
<p>You may of course customize your server to accept arbitrary flags the way you prefer.
This should be normally done with the generated main.go. For customization, you may either skip the generation of the main package (<code>--skip-main</code>)
and provide your own, or customize template generation to generate a custom main.</p>
<p>Here&apos;s an example: <a href="https://github.com/go-openapi/kvstore/blob/master/cmd/kvstored/main.go#L50-L57" target="_blank">kv store example</a></p>
<p>Originally from issue <a href="https://github.com/go-swagger/go-swagger/issues/1036" target="_blank">#1036</a>.</p>
<h3 id="how-do-you-integrate-the-flag-sets-of-go-swagger-and-other-packages-in-particular-glog"><a name="how-do-you-integrate-the-flag-sets-of-go-swagger-and-other-packages-in-particular-glog" class="plugin-anchor" href="#how-do-you-integrate-the-flag-sets-of-go-swagger-and-other-packages-in-particular-glog"><i class="fa fa-link" aria-hidden="true"></i></a>How do you integrate the flag sets of go-swagger and other packages, in particular, glog?</h3>
<p><em>Use-case</em>: logger</p>
<blockquote>
<p>I am trying to integrate a package into a go-swagger generated API that is using the <code>github.com/golang/glog</code> logger.
When I initialize the glog logger it appears to shield the flags defined in the go-swagger runtime.</p>
</blockquote>
<p><strong>Answer</strong>: the generated API has a Logger property that is a function with signature: <code>func(string, ...interface{})</code></p>
<p>You can configure it with any logger that exposes the signature.</p>
<p>eg.: <a href="https://github.com/go-swagger/go-swagger/blob/master/examples/authentication/restapi/configure_auth_sample.go#L33" target="_blank">https://github.com/go-swagger/go-swagger/blob/master/examples/authentication/restapi/configure_auth_sample.go#L33</a></p>
<p><em>Use-case</em>: logger flags</p>
<blockquote>
<p>Still having a problem with how and where to initialize glog so that both sets of flags are honored:
the runtime flags, such as <code>--tls-certificate</code> and the glog flags like <code>-log_dir</code> and <code>-stderrthreshold</code>.</p>
<p>If I initialize glog in the config_xxx.go I don&apos;t get the go-swagger runtime flags, and if I initialize glog in the engine, I get the error: <code>logging before flag.Parse</code>.
I realize that this question is not so much about logging <em>per se</em>, but more about how to merge the flag sets defined by different packages.</p>
</blockquote>
<p><strong>Answer</strong>: you can generate a server with <code>--flag-strategy pflag</code></p>
<p>After that you can use its integration to add goflags. You would do this in the main file.
Subsequently it&apos;s probably a good idea to generate code with <code>--exclude-main</code> so the update is preserved.</p>
<p>See also: <a href="https://github.com/spf13/pflag#supporting-go-flags-when-using-pflag" target="_blank">https://github.com/spf13/pflag#supporting-go-flags-when-using-pflag</a></p>
<p>Example:</p>
<pre class="language-"><code class="lang-golang">import (
    goflag &quot;flag&quot;
    flag &quot;github.com/spf13/pflag&quot;
)

var ip *int = flag.Int(&quot;flagname&quot;, 1234, &quot;help message for flagname&quot;)

func main() {
    flag.CommandLine.AddGoFlagSet(goflag.CommandLine)
    flag.Parse()
}
</code></pre>
<p>Originally from issue <a href="https://github.com/go-swagger/go-swagger/issues/762" target="_blank">#762</a>.</p>
<h3 id="how-to-serve-two-or-more-swagger-specs-from-one-server"><a name="how-to-serve-two-or-more-swagger-specs-from-one-server" class="plugin-anchor" href="#how-to-serve-two-or-more-swagger-specs-from-one-server"><i class="fa fa-link" aria-hidden="true"></i></a>How to serve two or more swagger specs from one server?</h3>
<p><em>Use-case</em>: I want a go-swagger generated server to serve 2 swagger specs that have no overlap on paths.
One is a generic metadata api that is implemented by many services and the other is a
service-specific api. The built-in server.go template Server struct, by having exactly
one API &amp; handler, appears to prevent this.</p>
<p><strong>Suggestions</strong>:</p>
<ol>
<li>Use go-swagger <code>mixin</code> command to merge specs into a single one</li>
<li>Create yourself a top-level swagger file that just includes the two lower-level ones (using <code>$ref</code>).
You may use go-swagger <code>flatten</code> to flatten the resulting spec</li>
<li>You can also make your own main function and use the code from the generation
of both spec (with <code>--skip-main</code>).
This allows for customization like using a different middleware stack, which in turn gives you
the ability to serve 2 swagger specs at different paths.</li>
</ol>
<p>Originally from issue <a href="https://github.com/go-swagger/go-swagger/issues/1005" target="_blank">#1005</a>. <em>(comes with a sample main.go for spec composition)</em>.</p>
<h3 id="how-to-access-access-api-struct-inside-operator-handler"><a name="how-to-access-access-api-struct-inside-operator-handler" class="plugin-anchor" href="#how-to-access-access-api-struct-inside-operator-handler"><i class="fa fa-link" aria-hidden="true"></i></a>How to access access API struct inside operator handler?</h3>
<p><em>Use-Case</em>:
my question is how can I access the generated API interface from within an operation handler function ?
Can i pass it somehow via context or any other way to do that?</p>
<p><strong>Answer</strong>: <strong>No</strong>. It&apos;s not reachable from within the handler anywhere.</p>
<blockquote>
<p>I created a module like apache access module ACL based on IP address for different URLs.
Instead of URL for lookup key I decided to use Operation.ID.
Lookup would be faster in that way because each operation has a unique id according to swagger specification.
The problem comes when I want to check against that ACL of mine...</p>
</blockquote>
<p><strong>Suggestions</strong>:
This is possible in 2 ways.</p>
<ul>
<li>first way is by using an authenticator,</li>
<li>the second way is making a middleware (not global)</li>
</ul>
<p>Example with Authenticator:</p>
<pre class="language-"><code class="lang-golang">// Authenticator represents an authentication strategy
// implementations of Authenticator know how to authenticate the
// request data and translate that into a valid principal object or an error
type Authenticator interface {
    Authenticate(interface{}) (bool, interface{}, error)
}
</code></pre>
<p>You may see the schemes currently supported here: <a href="https://github.com/go-openapi/runtime/tree/master/security" target="_blank">https://github.com/go-openapi/runtime/tree/master/security</a></p>
<p>Example with Middleware:</p>
<pre class="language-"><code class="lang-golang">// The middleware configuration is for the handler executors. These do not apply to the swagger.json document.
// The middleware executes after routing but before authentication, binding and validation.
func setupMiddlewares(handler http.Handler) http.Handler {
    return handler
}
</code></pre>
<p>to get to the matched route in one of those you can:</p>
<pre class="language-"><code class="lang-golang">import &quot;github.com/gorilla/context&quot;
context.Get(3, request)
</code></pre>
<p>That gets you a matched route.</p>
<blockquote>
<p>Note: it might be worth it to expose <code>Context</code> as an exported method on the API builder.
That would be a simple PR to add the following code in go-swagger</p>
<pre class="language-"><code class="lang-golang">func (o *LifecycleManagerAPI) Context() *middleware.Context {
    if o.context == nil {
        o.context = middleware.NewRoutableContext(o.spec, o, nil)
    }
    return o.context
}
</code></pre>
<p>then your middleware could take a context in and use <code>RouteInfo(request)</code> like this one: <a href="https://github.com/go-openapi/runtime/blob/master/middleware/security.go" target="_blank">https://github.com/go-openapi/runtime/blob/master/middleware/security.go</a>.</p>
</blockquote>
<p><em>Similar use-case</em>:
I have some domain objects I need access to in the handlers (db connection, telemetry client, etc).</p>
<p><em>What is the recommended way/place to define these and access them in the handlers?</em></p>
<blockquote>
<p>Would I define them in configure_xxx() and make wrapper functions for the handlers to make them accessible?
Or is there a nice way to add them to the context?
I was looking for some examples of this but couldn&apos;t find anything.</p>
</blockquote>
<p><strong>Hint</strong>: look at this one: <a href="https://github.com/go-openapi/kvstore" target="_blank">https://github.com/go-openapi/kvstore</a></p>
<p>The important takeaway is that main and the handlers have to be pulled outside of the generated code since only configure_xxx() is protected.
And main() doesn&apos;t call configureAPI() ...
that was a little confusing looking through the other examples and not seeing any changes to the vanilla config code.</p>
<p><em>Similar use-case</em>: dependency injection</p>
<p>Wouldn&apos;t it be better to have all the handlers automatically be part of a default struct that simply has a Context member variable or empty interface?</p>
<blockquote>
<p>That would save everyone a lot of copy/paste when we need to inject some info.
I mean, a different context than the one available on params.HTTPRequest.Context(),
more like an application level context, e.g. something I can stuff a database reference or other business state into.</p>
</blockquote>
<p><strong>Hint</strong>: remember that the generated packages are made of a series of files that you can extend and tailor to your own needs by adding more files.</p>
<p>For instance, a new (non generated) file in the operations package could bring to life the applicative context/dependencies injection and be called from the configure_xxx.
You may alternatively modify the generation by providing your own templates, and possibly extend the interface of the Server struct.</p>
<p>Originally from issue <a href="https://github.com/go-swagger/go-swagger/issues/661" target="_blank">#661</a>.</p>
<h3 id="use-go-swagger-to-generate-different-client-or-servers"><a name="use-go-swagger-to-generate-different-client-or-servers" class="plugin-anchor" href="#use-go-swagger-to-generate-different-client-or-servers"><i class="fa fa-link" aria-hidden="true"></i></a>Use go-swagger to generate different client or servers</h3>
<p><em>Use-Case</em>:
I am using go-swagger to generate some part of a server application automatically
and I would love to reuse our code by transforming the code in go templates.</p>
<blockquote>
<p>It would be  enough to export the <code>appGenerator</code> type and have a function that returns it (maybe generator.GenerateServer itself?).
I would then use <code>appGenerator</code> to execute the templates.
How could I realize this? Is it possible with go-swagger?</p>
</blockquote>
<p><strong>Answer</strong>: you can provide your own templates for go-swagger.</p>
<p>The client and server generators allow you to specify a directory on disk to add custom templates.</p>
<p>Here are some docs: <a href="http://goswagger.io/generate/templates/" target="_blank">http://goswagger.io/generate/templates/</a></p>
<blockquote>
<p>In VIC they do this: <a href="https://github.com/vmware/vic/tree/master/lib/apiservers/templates" target="_blank">https://github.com/vmware/vic/tree/master/lib/apiservers/templates</a>
<a href="https://github.com/vmware/vic/blob/master/Makefile#L274-L281" target="_blank">https://github.com/vmware/vic/blob/master/Makefile#L274-L281</a></p>
</blockquote>
<p><strong>Hint</strong>: you can also override templates by using the same names:
<a href="https://github.com/go-swagger/go-swagger/blob/master/generator/templates.go#L61-L73" target="_blank">https://github.com/go-swagger/go-swagger/blob/master/generator/templates.go#L61-L73</a></p>
<p><em>Wouldn&apos;t this generate roughly the same structure of the server?</em></p>
<blockquote>
<p>I don&apos;t want to change minor details, I want to have code that looks totally different
(but only for the server part, models and clients are more than okay) while using code the parsing and validation from go-swagger.
This means different number of files and different functionalities.</p>
</blockquote>
<p><strong>Answer</strong>: yes, it would generate a similar structure.</p>
<p>Note: customizing templates already brings many options to the table, including generating artifacts in other languages than go.</p>
<p>There is some documentation on the config file format here: <a href="https://github.com/go-swagger/go-swagger/blob/gen-layout-configfile/docs/use/template_layout.md" target="_blank">https://github.com/go-swagger/go-swagger/blob/gen-layout-configfile/docs/use/template_layout.md</a></p>
<p>Also keep in mind that <code>go-openapi</code> and <code>go-swagger</code> constitute a <em>toolkit</em>
and provide you the <em>tools</em> to adapt to your own use case.
The <code>swagger</code> command line and standard templates only covers general purpose use-cases.</p>
<p>If you think your use-case would benefit to many people, feel free to make the necessary changes for your case to work and submitting a PR.</p>
<p>Example config file for generation:</p>
<pre class="language-"><code class="lang-YAML">layout:
  application:
    - name: configure
      source: asset:serverConfigureapi
      target: &quot;{{ joinFilePath .Target .ServerPackage }}&quot;
      file_name: &quot;{{ .Name }}_client.go&quot;
      skip_exists: true
    - name: main
      source: asset:serverMain
      target: &quot;{{ joinFilePath .Target \&quot;cmd\&quot; (dasherize (pascalize .Name)) }}-server&quot;
      file_name: &quot;main.go&quot;
    - name: embedded_spec
      source: asset:swaggerJsonEmbed
      target: &quot;{{ joinFilePath .Target .ServerPackage }}&quot;
      file_name: &quot;embedded_spec.go&quot;
    - name: server
      source: asset:serverServer
      target: &quot;{{ joinFilePath .Target .ServerPackage }}&quot;
      file_name: &quot;server.go&quot;
    - name: builder
      source: asset:serverBuilder
      target: &quot;{{ joinFilePath .Target .ServerPackage .Package }}&quot;
      file_name: &quot;{{ snakize (pascalize .Name) }}_api.go&quot;
    - name: doc
      source: asset:serverDoc
      target: &quot;{{ joinFilePath .Target .ServerPackage }}&quot;
      file_name: &quot;doc.go&quot;
  models:
   - name: definition
     source: asset:model
     target: &quot;{{ joinFilePath .Target .ModelPackage }}&quot;
     file_name: &quot;{{ (snakize (pascalize .Name)) }}.go&quot;
  operations:
   - name: parameters
     source: asset:serverParameter
     target: &quot;{{ joinFilePath .Target .ServerPackage .APIPackage .Package }}&quot;
     file_name: &quot;{{ (snakize (pascalize .Name)) }}_parameters.go&quot;
   - name: responses
     source: asset:serverResponses
     target: &quot;{{ joinFilePath .Target .ServerPackage .APIPackage .Package }}&quot;
     file_name: &quot;{{ (snakize (pascalize .Name)) }}_responses.go&quot;
   - name: handler
     source: asset:serverOperation
     target: &quot;{{ joinFilePath .Target .ServerPackage .APIPackage .Package }}&quot;
     file_name: &quot;{{ (snakize (pascalize .Name)) }}.go&quot;
</code></pre>
<h3 id="support-streaming-responses"><a name="support-streaming-responses" class="plugin-anchor" href="#support-streaming-responses"><i class="fa fa-link" aria-hidden="true"></i></a>Support streaming responses</h3>
<p><em>Use-Case</em>: Docker client expects a stream of JSON structs from daemon to show a progress bar, as in:</p>
<pre class="language-"><code class="lang-bash"><span class="token function">curl</span> -i -X POST http://IP:PORT/images/create?fromImage<span class="token operator">=</span>alpine<span class="token operator">&amp;</span><span class="token assign-left variable">tag</span><span class="token operator">=</span>latest
</code></pre>
<p><em>How could I write a server providing a streaming response?</em></p>
<p><strong>Answer</strong>: Operations in the generated server are expected to return a responder.</p>
<p>This interface is defined as:</p>
<pre class="language-"><code class="lang-golang">// Responder is an interface for types to implement
// when they want to be considered for writing HTTP responses
type Responder interface {
    WriteResponse(http.ResponseWriter, httpkit.Producer)
}
</code></pre>
<p>With the <code>middleware.ResponderFunc</code> helper construct, you can just write a <code>func(http.ResponseWriter, httpkit.Producer)</code>
where you want a streaming response.</p>
<p>This should be sufficient. However:</p>
<blockquote>
<p>I&apos;ve toyed with a channel based stream where you send struct objects to a channel, which then gets streamed to the browser.
I decided against this because it seemed to just add complexity for little benefit.
I can be persuaded to implement such a responder though, and should somebody send a PR like that I would not say no to it.</p>
</blockquote>
<p>Originally from issue <a href="https://github.com/go-swagger/go-swagger/issues/305" target="_blank">#305</a>.</p>
<h3 id="oauth-authentication-does-not-redirect-to-the-authorization-server"><a name="oauth-authentication-does-not-redirect-to-the-authorization-server" class="plugin-anchor" href="#oauth-authentication-does-not-redirect-to-the-authorization-server"><i class="fa fa-link" aria-hidden="true"></i></a>OAuth authentication does not redirect to the authorization server</h3>
<p><em>Use-Case</em>: oauth2 accessCode flow does not redirect to the authorization server</p>
<blockquote>
<p>In my understanding, if the accessCode flow is used for oauth2 securitydefinition, the generated server could redirect the authentication to the oauth2 server, e.g., <a href="https://accounts.google.com/o/oauth2/v2/auth" target="_blank">https://accounts.google.com/o/oauth2/v2/auth</a>. However, my generated code does not perform the redirection. Could anyone help on this? Thanks.</p>
</blockquote>
<p>Like in:</p>
<pre class="language-"><code class="lang-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">swagger</span><span class="token punctuation">:</span> <span class="token string">&apos;2.0&apos;</span>
<span class="token key atrule">info</span><span class="token punctuation">:</span>
  <span class="token key atrule">title</span><span class="token punctuation">:</span> oauth2 debug
  <span class="token key atrule">version</span><span class="token punctuation">:</span> 0.3.0
<span class="token key atrule">produces</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> application/json
<span class="token key atrule">schemes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> http
<span class="token key atrule">basePath</span><span class="token punctuation">:</span> /api
<span class="token key atrule">securityDefinitions</span><span class="token punctuation">:</span>
  <span class="token key atrule">OauthSecurity</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> oauth2
    <span class="token key atrule">flow</span><span class="token punctuation">:</span> accessCode
    <span class="token key atrule">authorizationUrl</span><span class="token punctuation">:</span> <span class="token string">&apos;https://accounts.google.com/o/oauth2/v2/auth&apos;</span>
    <span class="token key atrule">tokenUrl</span><span class="token punctuation">:</span> <span class="token string">&apos;hhttps://www.googleapis.com/oauth2/v4/token&apos;</span>
    <span class="token key atrule">scopes</span><span class="token punctuation">:</span>
      <span class="token key atrule">admin</span><span class="token punctuation">:</span> Admin scope
      <span class="token key atrule">user</span><span class="token punctuation">:</span> User scope
<span class="token key atrule">security</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">OauthSecurity</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> user
<span class="token key atrule">paths</span><span class="token punctuation">:</span>
  <span class="token key atrule">/customers</span><span class="token punctuation">:</span>
  <span class="token punctuation">...</span>.
</code></pre>
<blockquote>
<p>The generated server does not redirect the browser to the google login page.</p>
</blockquote>
<p><strong>Answer</strong>: Redirection flow is for UI. The spec has them so your UI can do the redirection.</p>
<p>Swagger 2.0 only defines those properties as hints for a UI to work,
this doesn&apos;t have to be server side. At the same time the redirection flow is not supported in an API
but you can use an OAuth 2.0 middleware from any library to get you that functionality</p>
<p>Originally from issue <a href="https://github.com/go-swagger/go-swagger/issues/1217" target="_blank">#1217</a>.</p>
<h3 id="https-tls-cipher-suites-not-supported-by-aws-elastic-loadbalancer"><a name="https-tls-cipher-suites-not-supported-by-aws-elastic-loadbalancer" class="plugin-anchor" href="#https-tls-cipher-suites-not-supported-by-aws-elastic-loadbalancer"><i class="fa fa-link" aria-hidden="true"></i></a>HTTPS TLS Cipher Suites not supported by AWS Elastic LoadBalancer</h3>
<p><em>Use-case</em>: AWS Elastic LoadBalancer forwards https requests to instances, and their security policy is &apos;ELBSecurityPolicy-2016-08&apos;.
However, while running the server on https, the server keeps on logging</p>
<p><code>http: TLS handshake error from 192.168.X.X:XXXXX: tls: no cipher suite supported by both client and server.</code></p>
<p>If we remove the cipher suites on the generated code, it resolves the issue -</p>
<pre class="language-"><code class="lang-golang">CipherSuites: []uint16{
  tls.TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,
  tls.TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,
  tls.TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,
  tls.TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,
},
</code></pre>
<p>The ELB security policy &apos;ELBSecurityPolicy-2016-08&apos; does include these cipher suites, however all requests sent by the ELB are rejected by the server.</p>
<p><strong>Answer</strong>: you can generate the server with a different compatibility mode for the older generation of ciphers</p>
<pre class="language-"><code>swagger generate server --compatibility-mode=intermediate
</code></pre><p>Originally from issue <a href="https://github.com/go-swagger/go-swagger/issues/1383" target="_blank">#1383</a>.</p>
<h3 id="which-mime-types-are-supported"><a name="which-mime-types-are-supported" class="plugin-anchor" href="#which-mime-types-are-supported"><i class="fa fa-link" aria-hidden="true"></i></a>Which mime types are supported?</h3>
<p><em>Use-Case</em>: I seem to be unable to find supported mime-types that the API&apos;s can consume and produce. Any references?</p>
<p><strong>Answer</strong>: see the current list of supported media MIMEs <a href="https://github.com/go-swagger/go-swagger/blob/3099f611ada66d42974160ac4e0ec475d24b7041/generator/support.go#L279" target="_blank">here</a>
You can add more through the consumer producer mechanism.</p>
<p>Originally from issue <a href="https://github.com/go-swagger/go-swagger/issues/1022" target="_blank">#1022</a>.</p>
<h3 id="is-it-possible-to-return-error-to-main-function-of-server"><a name="is-it-possible-to-return-error-to-main-function-of-server" class="plugin-anchor" href="#is-it-possible-to-return-error-to-main-function-of-server"><i class="fa fa-link" aria-hidden="true"></i></a>Is it possible to return error to main function of server?</h3>
<p><em>Use-Case</em>: Is it possible to return error to main function of server?</p>
<blockquote>
<p>For example, my server saves some configs in file, and I want that if config file is missing,
then server must be stopped with some error code. It is possible to do it with panic(err),
but I think it is not good way. So can I return error main function of server ?</p>
</blockquote>
<p><strong>Answer</strong>: you can make your own main function.</p>
<p>There is an example here: <a href="https://github.com/go-openapi/kvstore/blob/master/cmd/kvstored/main.go" target="_blank">https://github.com/go-openapi/kvstore/blob/master/cmd/kvstored/main.go</a></p>
<p>There is a command line argument to avoid overwriting the main when generating: <code>--exclude-main</code>.</p>
<p>Originally from issue <a href="https://github.com/go-swagger/go-swagger/issues/1060" target="_blank">#1060</a>.</p>
<hr>
<p>Back to <a href="./#all-contributed-questions">all contributions</a></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="faq_model.html" class="navigation navigation-prev " aria-label="Previous page: Model generation">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="faq_client.html" class="navigation navigation-next " aria-label="Next page: Client generation">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Server generation & customization","level":"1.9.3","depth":2,"next":{"title":"Client generation","level":"1.9.4","depth":2,"path":"faq/faq_client.md","ref":"faq/faq_client.md","articles":[]},"previous":{"title":"Model generation","level":"1.9.2","depth":2,"path":"faq/faq_model.md","ref":"faq/faq_model.md","articles":[]},"dir":"ltr"},"config":{"plugins":["forkmegithub","prism","-highlight","anchors"],"root":"./docs","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"forkmegithub":{"color":"green","url":"https://github.com/go-swagger/go-swagger"},"prism":{},"anchors":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"faq/faq_server.md","mtime":"2022-01-23T17:15:45.318Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-01-23T22:21:57.083Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-forkmegithub/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

