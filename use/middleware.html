
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Using middleware Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-forkmegithub/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="template_layout.html" />
    
    
    <link rel="prev" href="spec/ignore.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Primer
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="../about.html">
            
                <a href="../about.html">
            
                    
                    Approaches
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="../install.html">
            
                <a href="../install.html">
            
                    
                    Installation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../features.html">
            
                <a href="../features.html">
            
                    
                    Features
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Tutorials
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../tutorial/todo-list.html">
            
                <a href="../tutorial/todo-list.html">
            
                    
                    Simple Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../tutorial/custom-server.html">
            
                <a href="../tutorial/custom-server.html">
            
                    
                    Custom Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../tutorial/dynamic.html">
            
                <a href="../tutorial/dynamic.html">
            
                    
                    Dynamic Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" >
            
                <span>
            
                    
                    Security
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="../tutorial/authentication/">
            
                <a href="../tutorial/authentication/">
            
                    
                    Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.2" data-path="../tutorial/oauth2/">
            
                <a href="../tutorial/oauth2/">
            
                    
                    OAuth2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.3" data-path="../tutorial/composed-auth/">
            
                <a href="../tutorial/composed-auth/">
            
                    
                    Composition
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Use-Cases
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../usage/swagger.html">
            
                <a href="../usage/swagger.html">
            
                    
                    Options and commands
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../usage/serve_ui.html">
            
                <a href="../usage/serve_ui.html">
            
                    
                    Serve UI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../usage/validate.html">
            
                <a href="../usage/validate.html">
            
                    
                    Validate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../usage/diff.html">
            
                <a href="../usage/diff.html">
            
                    
                    Diff
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="transform.html">
            
                <a href="transform.html">
            
                    
                    Transform spec
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.5.1" data-path="../usage/expand.html">
            
                <a href="../usage/expand.html">
            
                    
                    Expand
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.2" data-path="../usage/flatten.html">
            
                <a href="../usage/flatten.html">
            
                    
                    Flatten
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.3" data-path="../usage/mixin.html">
            
                <a href="../usage/mixin.html">
            
                    
                    Mixin
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../usage/markdown.html">
            
                <a href="../usage/markdown.html">
            
                    
                    Generate markdown
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" >
            
                <span>
            
                    
                    Generate code from spec
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.7.1" data-path="../generate/requirements.html">
            
                <a href="../generate/requirements.html">
            
                    
                    Dependencies & Requirements
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.2" data-path="../generate/client.html">
            
                <a href="../generate/client.html">
            
                    
                    API Client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.3" data-path="../generate/cli.html">
            
                <a href="../generate/cli.html">
            
                    
                    CLI (Command Line Tool)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.4" >
            
                <span>
            
                    
                    API Server
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.7.4.1" data-path="../generate/server.html">
            
                <a href="../generate/server.html">
            
                    
                    Server Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.4.2" data-path="server.html">
            
                <a href="server.html">
            
                    
                    How to use the server
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.7.5" >
            
                <span>
            
                    
                    API Model
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.7.5.1" data-path="../generate/model.html">
            
                <a href="../generate/model.html">
            
                    
                    Model Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7.5.2" data-path="model.html">
            
                <a href="model.html">
            
                    
                    How to use models
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.7.5.2.1" data-path="models/schemas.html">
            
                <a href="models/schemas.html">
            
                    
                    Schema generation rules
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.8" >
            
                <span>
            
                    
                    Generate spec from source
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.8.1" data-path="../generate/spec.html">
            
                <a href="../generate/spec.html">
            
                    
                    Spec Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2" data-path="spec.html">
            
                <a href="spec.html">
            
                    
                    Spec generation rules
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.8.2.1" data-path="spec/meta.html">
            
                <a href="spec/meta.html">
            
                    
                    swagger:meta
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.2" data-path="spec/route.html">
            
                <a href="spec/route.html">
            
                    
                    swagger:route
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.3" data-path="spec/params.html">
            
                <a href="spec/params.html">
            
                    
                    swagger:params
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.4" data-path="spec/operation.html">
            
                <a href="spec/operation.html">
            
                    
                    swagger:operation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.5" data-path="spec/response.html">
            
                <a href="spec/response.html">
            
                    
                    swagger:response
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.6" data-path="spec/model.html">
            
                <a href="spec/model.html">
            
                    
                    swagger:model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.7" data-path="spec/allOf.html">
            
                <a href="spec/allOf.html">
            
                    
                    swagger:allOf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.8" data-path="spec/strfmt.html">
            
                <a href="spec/strfmt.html">
            
                    
                    swagger:strfmt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.9" data-path="spec/discriminated.html">
            
                <a href="spec/discriminated.html">
            
                    
                    swagger:discriminated
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8.2.10" data-path="spec/ignore.html">
            
                <a href="spec/ignore.html">
            
                    
                    swagger:ignore
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.5" data-path="middleware.html">
            
                <a href="middleware.html">
            
                    
                    Using middleware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="template_layout.html">
            
                <a href="template_layout.html">
            
                    
                    Custom generation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../generate/templates.html">
            
                <a href="../generate/templates.html">
            
                    
                    Custom templates
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../cli_helpers.html">
            
                <a href="../cli_helpers.html">
            
                    
                    CLI autocompletion
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../guidelines/">
            
                <a href="../guidelines/">
            
                    
                    Guidelines to maintainers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../faq/">
            
                <a href="../faq/">
            
                    
                    FAQ
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../faq/faq_setup.html">
            
                <a href="../faq/faq_setup.html">
            
                    
                    Installation,setup and environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../faq/faq_model.html">
            
                <a href="../faq/faq_model.html">
            
                    
                    Model generation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../faq/faq_server.html">
            
                <a href="../faq/faq_server.html">
            
                    
                    Server generation & customization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../faq/faq_client.html">
            
                <a href="../faq/faq_client.html">
            
                    
                    Client generation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../faq/faq_spec.html">
            
                <a href="../faq/faq_spec.html">
            
                    
                    Spec generation from source
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../faq/faq_testing.html">
            
                <a href="../faq/faq_testing.html">
            
                    
                    API testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="../faq/faq_documenting.html">
            
                <a href="../faq/faq_documenting.html">
            
                    
                    Documenting your API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="../faq/faq_swagger.html">
            
                <a href="../faq/faq_swagger.html">
            
                    
                    Swagger specification
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Using middleware</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="build-your-own-middleware"><a name="build-your-own-middleware" class="plugin-anchor" href="#build-your-own-middleware"><i class="fa fa-link" aria-hidden="true"></i></a>Build Your Own middleware</h1>
<p>Go-swagger chose the golang <code>net/http</code> package as base abstraction. That means that for <em>any</em> supported transport by the toolkit you can reuse <em>any</em> middleware existing middlewares that following the stdlib middleware pattern.</p>
<!--more-->
<p>There are several projects providing middleware libraries for weaving all kinds of functionality into your request handling. None of those things are the job of go-swagger, go-swagger just serves your specs.</p>
<p>The server takes care of a number of things when a request arrives:</p>
<ul>
<li>routing</li>
<li>authentication</li>
<li>input validation</li>
<li>content negotiation</li>
<li>parameter and body binding</li>
</ul>
<p>If you&apos;re unfamiliar with the concept of golang net/http middlewares you can read up on it here:<br><a href="http://www.alexedwards.net/blog/making-and-using-middleware" target="_blank">Making and Using HTTP Middleware</a></p>
<p>Besides serving the swagger specification as an API, the toolkit also serves the actual swagger specification document.
The convention is to use the <code>/swagger.json</code> location for serving up the specification document, so we serve the
specification at that path.</p>
<h3 id="add-middleware"><a name="add-middleware" class="plugin-anchor" href="#add-middleware"><i class="fa fa-link" aria-hidden="true"></i></a>Add middleware</h3>
<p>The generated server allows for 3 extension points to inject middleware in its middleware chain. These have to do with
the lifecycle of a request. You can find those hooks in the configure_xxx_api.go file.</p>
<p>The first one is to add middleware all the way to the top of the middleware stack. To do this you add them in the
<code>setupGlobalMiddleware</code> method. This middleware applies to everything in the go-swagger managed API.</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">setupGlobalMiddleware</span><span class="token punctuation">(</span>handler http<span class="token punctuation">.</span>Handler<span class="token punctuation">)</span> http<span class="token punctuation">.</span>Handler <span class="token punctuation">{</span>
    <span class="token keyword">return</span> handler
<span class="token punctuation">}</span>
</code></pre>
<p>The second extension point allows for middleware to be injected right before actually handling a matched request.
This excludes the swagger.json document from being affected by this middleware though.  This extension point makes the
middlewares execute right after routing but right before authentication, binding and validation.  You add middlewares
to this point by editing the <code>setupMiddlewares</code> method in configure_xxx_api.go</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">setupMiddlewares</span><span class="token punctuation">(</span>handler http<span class="token punctuation">.</span>Handler<span class="token punctuation">)</span> http<span class="token punctuation">.</span>Handler <span class="token punctuation">{</span>
    <span class="token keyword">return</span> handler
<span class="token punctuation">}</span>
</code></pre>
<p>The third point allows you to set the middleware for existing handler by its route and HTTP method. It can be done in the <code>configureAPI</code> function by calling <code>api.AddMiddlewareFor</code> method.</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">configureAPI</span><span class="token punctuation">(</span>api <span class="token operator">*</span>operations<span class="token punctuation">.</span>SomeAPI<span class="token punctuation">)</span> http<span class="token punctuation">.</span>Handler <span class="token punctuation">{</span>
    api<span class="token punctuation">.</span><span class="token function">AddMiddlewareFor</span><span class="token punctuation">(</span><span class="token string">&apos;GET&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> customMiddlewareFunc<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The global middleware is an excellent place to do things like panic handling, request logging or adding metrics.  While
the plain middleware allows you to kind of filter this by request path without having to take care of routing. You also
get access to the full context that the go-swagger toolkit uses throughout the lifecycle of a request.</p>
<h4 id="add-logging-and-panic-handling"><a name="add-logging-and-panic-handling" class="plugin-anchor" href="#add-logging-and-panic-handling"><i class="fa fa-link" aria-hidden="true"></i></a>Add logging and panic handling</h4>
<p>A very common requirement for HTTP APIs is to include some form of logging. Another one is to handle panics from your
API requests.  The example for a possible implementation of this uses <a href="https://github.com/dre1080/recover" target="_blank">this community provided
middleware</a> to catch panics.</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">setupGlobalMiddleware</span><span class="token punctuation">(</span>handler http<span class="token punctuation">.</span>Handler<span class="token punctuation">)</span> http<span class="token punctuation">.</span>Handler <span class="token punctuation">{</span>
  recovery <span class="token operator">:=</span> <span class="token builtin">recover</span><span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token builtin">recover</span><span class="token punctuation">.</span>Options<span class="token punctuation">{</span>
    Log<span class="token punctuation">:</span> log<span class="token punctuation">.</span>Print<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token function">recovery</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>There are tons of middlewares out there, some are framework specific and some frameworks don&apos;t really use the plain
vanilla golang net/http as base abstraction. For those you can use a project like <a href="https://github.com/carbocation/interpose" target="_blank">interpose</a> that serves as an adapter
layer so you can still reuse middlewares. Of course nobody is stopping you to just implement your own middlewares.</p>
<p>For example using interpose to integrate with <a href="https://github.com/carbocation/interpose/blob/master/middleware/negronilogrus.go" target="_blank">logrus</a>.</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">import</span> <span class="token punctuation">(</span>
  interpose <span class="token string">&quot;github.com/carbocation/interpose/middleware&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">func</span> <span class="token function">setupGlobalMiddleware</span><span class="token punctuation">(</span>handler http<span class="token punctuation">.</span>Handler<span class="token punctuation">)</span> http<span class="token punctuation">.</span>Handler <span class="token punctuation">{</span>
  logViaLogrus <span class="token operator">:=</span> interpose<span class="token punctuation">.</span><span class="token function">NegroniLogrus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token function">logViaLogrus</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>And you can compose these middlewares into a stack using functions.</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">setupGlobalMiddleware</span><span class="token punctuation">(</span>handler http<span class="token punctuation">.</span>Handler<span class="token punctuation">)</span> http<span class="token punctuation">.</span>Handler <span class="token punctuation">{</span>
  handlePanic <span class="token operator">:=</span> <span class="token builtin">recover</span><span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token builtin">recover</span><span class="token punctuation">.</span>Options<span class="token punctuation">{</span>
    Log<span class="token punctuation">:</span> log<span class="token punctuation">.</span>Print<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  logViaLogrus <span class="token operator">:=</span> interpose<span class="token punctuation">.</span><span class="token function">NegroniLogrus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token function">handlePanic</span><span class="token punctuation">(</span>
    <span class="token function">logViaLogrus</span><span class="token punctuation">(</span>
      handler
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="add-rate-limiting"><a name="add-rate-limiting" class="plugin-anchor" href="#add-rate-limiting"><i class="fa fa-link" aria-hidden="true"></i></a>Add rate limiting</h4>
<p>You can also add rate limiting in a similar way. Let&apos;s say we just want to rate limit the valid requests to our swagger
API. To do so we could use <a href="https://github.com/didip/tollbooth" target="_blank">tollbooth</a>.</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">setupMiddlewares</span><span class="token punctuation">(</span>handler http<span class="token punctuation">.</span>Handler<span class="token punctuation">)</span> http<span class="token punctuation">.</span>Handler <span class="token punctuation">{</span>
  limiter <span class="token operator">:=</span> tollbooth<span class="token punctuation">.</span><span class="token function">NewLimiter</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
  limiter<span class="token punctuation">.</span>IPLookups <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;RemoteAddr&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;X-Forwarded-For&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;X-Real-IP&quot;</span><span class="token punctuation">}</span>
    <span class="token keyword">return</span> tollbooth<span class="token punctuation">.</span><span class="token function">LimitFuncHandler</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>And with this you&apos;ve added rate limiting to your application.</p>
<h4 id="add-middleware-to-certain-routes"><a name="add-middleware-to-certain-routes" class="plugin-anchor" href="#add-middleware-to-certain-routes"><i class="fa fa-link" aria-hidden="true"></i></a>Add middleware to certain routes</h4>
<p>You can add standard <code>net/http</code> middleware to certain routes.</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">myMiddleware</span><span class="token punctuation">(</span>handler http<span class="token punctuation">.</span>Handler<span class="token punctuation">)</span> http<span class="token punctuation">.</span>Handler <span class="token punctuation">{</span>
    <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">HandlerFunc</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// do some middleware logic here</span>
            handler<span class="token punctuation">.</span><span class="token function">ServeHTTP</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token operator">...</span>
api<span class="token punctuation">.</span><span class="token function">AddMiddlewareFor</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/example&quot;</span><span class="token punctuation">,</span> myMiddleware<span class="token punctuation">)</span>
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="spec/ignore.html" class="navigation navigation-prev " aria-label="Previous page: swagger:ignore">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="template_layout.html" class="navigation navigation-next " aria-label="Next page: Custom generation">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Using middleware","level":"1.5","depth":1,"next":{"title":"Custom generation","level":"1.6","depth":1,"path":"use/template_layout.md","ref":"use/template_layout.md","articles":[{"title":"Custom templates","level":"1.6.1","depth":2,"path":"generate/templates.md","ref":"generate/templates.md","articles":[]}]},"previous":{"title":"swagger:ignore","level":"1.4.8.2.10","depth":4,"path":"use/spec/ignore.md","ref":"use/spec/ignore.md","articles":[]},"dir":"ltr"},"config":{"plugins":["forkmegithub","prism","-highlight","anchors"],"root":"./docs","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"forkmegithub":{"color":"green","url":"https://github.com/go-swagger/go-swagger"},"prism":{},"anchors":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"use/middleware.md","mtime":"2020-02-28T16:11:13.850Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-01-23T22:21:57.083Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-forkmegithub/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

